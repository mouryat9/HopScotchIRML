@import url("https://cdn.jsdelivr.net/npm/geist@1.3.0/dist/fonts/geist-sans/style.css");

/* ========================================================
   CSS Variables — Brand palette derived from logo
   ======================================================== */

:root {
  /* Brand primaries (from logo) */
  --hop-navy:           #2B4C7E;
  --hop-navy-dark:      #1E3A5F;
  --hop-navy-light:     #3D6098;
  --hop-green:          #6DB33F;
  --hop-green-dark:     #5A9A2F;
  --hop-green-light:    #8BC764;

  /* Accent (dark navy) */
  --hop-blue:           #1E2740;
  --hop-blue-dark:      #151C30;
  --hop-blue-light:     #384560;

  /* Neutrals */
  --hop-white:          #FFFFFF;
  --hop-bg:             #FAFBFC;
  --hop-surface:        #FFFFFF;
  --hop-border:         #EBEEF2;
  --hop-border-light:   #F3F5F7;
  --hop-muted:          #6B7280;
  --hop-ink:            #1A2332;
  --hop-ink-secondary:  #4A5568;

  /* Semantic */
  --hop-success:        #6DB33F;
  --hop-success-bg:     #EFF8E8;
  --hop-error:          #DC3545;
  --hop-error-bg:       #FDF2F2;
  --hop-info:           #1E2740;
  --hop-info-bg:        #EBEDF2;

  /* Shadows */
  --hop-shadow-sm:      0 1px 2px rgba(0, 0, 0, 0.04);
  --hop-shadow-md:      0 2px 8px rgba(0, 0, 0, 0.06);
  --hop-shadow-lg:      0 4px 16px rgba(0, 0, 0, 0.08);

  /* Radii */
  --hop-radius-sm:      8px;
  --hop-radius-md:      12px;
  --hop-radius-lg:      16px;
  --hop-radius-xl:      20px;
  --hop-radius-pill:    999px;

  /* Transitions */
  --hop-ease:           0.18s ease-out;

  /* Extra tokens for hardcoded colors */
  --hop-neutral-bg:     #F3F4F6;
  --hop-placeholder:    #C4C9D2;
  --hop-panel-dark:     #1A1A2E;
}

/* ========================================================
   Dark Mode Overrides
   ======================================================== */

:root[data-theme="dark"] {
  --hop-navy:           #5B8CC8;
  --hop-navy-dark:      #7BA3D6;
  --hop-navy-light:     #4A7AB8;
  --hop-green:          #7BC74F;
  --hop-green-dark:     #6DB33F;
  --hop-green-light:    #90D66A;

  --hop-blue:           #4A6FA5;
  --hop-blue-dark:      #3D5F90;
  --hop-blue-light:     #6B8FC0;

  --hop-white:          #1A1D23;
  --hop-bg:             #12151A;
  --hop-surface:        #1E2128;
  --hop-border:         #2D3340;
  --hop-border-light:   #252B36;
  --hop-muted:          #8896A6;
  --hop-ink:            #E8ECF1;
  --hop-ink-secondary:  #B0BAC5;

  --hop-success:        #7BC74F;
  --hop-success-bg:     #1A2E1A;
  --hop-error:          #F06060;
  --hop-error-bg:       #2E1A1A;
  --hop-info:           #6B8FC0;
  --hop-info-bg:        #1A2030;

  --hop-shadow-sm:      0 1px 2px rgba(0, 0, 0, 0.2);
  --hop-shadow-md:      0 2px 8px rgba(0, 0, 0, 0.3);
  --hop-shadow-lg:      0 4px 16px rgba(0, 0, 0, 0.4);

  --hop-neutral-bg:     #252B36;
  --hop-placeholder:    #555E6B;
  --hop-panel-dark:     #0F1118;
}

/* ========================================================
   Global
   ======================================================== */

body {
  margin: 0;
  color: var(--hop-ink);
  background: var(--hop-bg);
  font-family: "Geist Sans", "Geist", system-ui, -apple-system, "Segoe UI", sans-serif;
  font-weight: 400;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  letter-spacing: -0.011em;
}

h1, h2, h3, h4, h5, h6 {
  font-family: "Geist Sans", "Geist", system-ui, -apple-system, "Segoe UI", sans-serif;
  font-weight: 700;
  letter-spacing: -0.025em;
}

/* ========================================================
   Page wrapper
   ======================================================== */

.hop-wrap {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: var(--hop-white);
}

.hop-content {
  padding: 16px 2.5rem 32px;
  max-width: 1600px;
  margin: 0 auto;
  width: 100%;
  box-sizing: border-box;
}

/* ========================================================
   Header
   ======================================================== */

.hop-header {
  padding: 1rem 2.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: rgba(255, 255, 255, 0.72);
  backdrop-filter: blur(16px) saturate(1.6);
  -webkit-backdrop-filter: blur(16px) saturate(1.6);
  border-bottom: 1px solid rgba(255, 255, 255, 0.4);
  box-shadow:
    0 1px 3px rgba(0, 0, 0, 0.04),
    inset 0 -1px 0 rgba(0, 0, 0, 0.04);
  position: sticky;
  top: 0;
  z-index: 30;
}

.hop-header__left {
  display: flex;
  align-items: center;
  gap: 14px;
}

.hop-logo {
  height: 48px;
  width: auto;
  display: block;
  animation: none;
}

.hop-app-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--hop-ink);
}

.hop-header__right {
  display: flex;
  align-items: center;
  gap: 14px;
}

/* Divider dot between name and sign-out */
.hop-header__divider {
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: var(--hop-border);
}

/* Sign-out pill button (matches login page outlined style) */
.hop-header__signout {
  padding: 0.45rem 1.4rem;
  font-size: 0.85rem;
  font-weight: 500;
  font-family: inherit;
  border-radius: var(--hop-radius-pill);
  border: 1.5px solid var(--hop-border);
  background: transparent;
  color: var(--hop-ink-secondary);
  cursor: pointer;
  transition: border-color 0.15s, color 0.15s, box-shadow 0.15s;
}

.hop-header__signout:hover {
  border-color: var(--hop-blue);
  color: var(--hop-blue);
  box-shadow: 0 2px 8px rgba(30, 39, 64, 0.1);
}

/* Download dropdown */
.hop-download {
  position: relative;
}

.hop-header__download {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.45rem 1.4rem;
  font-size: 0.85rem;
  font-weight: 500;
  font-family: inherit;
  border-radius: var(--hop-radius-pill);
  border: 1.5px solid var(--hop-blue);
  background: var(--hop-blue);
  color: white;
  cursor: pointer;
  transition: background 0.15s, border-color 0.15s, box-shadow 0.15s, transform 0.15s;
}

.hop-header__download:hover {
  background: var(--hop-blue-dark);
  border-color: var(--hop-blue-dark);
  box-shadow: 0 2px 12px rgba(43, 94, 167, 0.25);
  transform: translateY(-1px);
}

.hop-download__arrow {
  font-size: 0.65rem;
  transition: transform 0.2s;
}

.hop-download__arrow--open {
  transform: rotate(180deg);
}

.hop-download__menu {
  position: absolute;
  top: calc(100% + 6px);
  right: 0;
  min-width: 240px;
  background: rgba(255, 255, 255, 0.82);
  backdrop-filter: blur(20px) saturate(1.6);
  -webkit-backdrop-filter: blur(20px) saturate(1.6);
  border: 1px solid rgba(255, 255, 255, 0.5);
  border-radius: var(--hop-radius-md);
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.12),
    0 2px 8px rgba(0, 0, 0, 0.04);
  z-index: 50;
  padding: 4px;
  animation: dropdownFadeIn 0.15s ease-out;
}

@keyframes dropdownFadeIn {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

.hop-download__item {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  width: 100%;
  padding: 0.6rem 0.75rem;
  font-size: 0.85rem;
  font-weight: 500;
  font-family: inherit;
  color: var(--hop-ink);
  background: transparent;
  border: none;
  border-radius: var(--hop-radius-sm);
  cursor: pointer;
  text-align: left;
  transition: background 0.1s;
}

.hop-download__item:hover {
  background: var(--hop-bg);
}

.hop-download__item--disabled {
  opacity: 0.45;
  cursor: not-allowed;
}

.hop-download__item--disabled:hover {
  background: transparent;
}

.hop-download__icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 24px;
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 0.03em;
  border-radius: 4px;
  flex-shrink: 0;
  color: #fff;
  background: var(--hop-blue);
}

.hop-download__lock {
  margin-left: auto;
  font-size: 0.68rem;
  font-weight: 600;
  color: var(--hop-muted);
  background: var(--hop-neutral-bg);
  padding: 1px 6px;
  border-radius: 999px;
}

/* ========================================================
   Badge / Chip
   ======================================================== */

.badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  font-weight: 600;
  padding: 4px 12px;
  border-radius: 999px;
  background: var(--hop-success-bg);
  color: var(--hop-green-dark);
  border: 1px solid rgba(30, 39, 64, 0.25);
}

.badge--error {
  background: var(--hop-error-bg);
  color: var(--hop-error);
  border-color: rgba(220, 53, 69, 0.25);
}
.badge--success {
  background: rgba(26, 138, 125, 0.1);
  color: #1A8A7D;
  border-color: rgba(26, 138, 125, 0.25);
}

.badge--neutral {
  background: var(--hop-neutral-bg);
  color: var(--hop-muted);
  border-color: var(--hop-border);
}

/* ========================================================
   Step Progress Bar (numbered dots)
   ======================================================== */

.step-progress {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0;
  margin: 0 auto 12px;
  max-width: 820px;
  padding: 10px 16px;
}

.step-progress__item {
  display: flex;
  align-items: center;
  flex: 1;
}

.step-progress__item:last-child {
  flex: 0;
}

.step-progress__dot {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 2px solid var(--hop-border);
  background: var(--hop-surface);
  color: var(--hop-muted);
  font-size: 12px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.25s cubic-bezier(0.32, 1.28, 0.48, 1);
  flex-shrink: 0;
  position: relative;
  z-index: 1;
  font-family: inherit;
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.06);
}

.step-progress__dot:hover {
  border-color: var(--hop-blue-light);
  color: var(--hop-blue);
  transform: scale(1.15);
  box-shadow:
    0 0 0 4px rgba(30, 39, 64, 0.06),
    inset 0 1px 3px rgba(0, 0, 0, 0.06);
}

.step-progress__dot--active {
  background: linear-gradient(135deg, var(--hop-blue) 0%, var(--hop-blue-dark) 100%);
  border-color: var(--hop-blue);
  color: #fff;
  box-shadow:
    0 0 0 4px rgba(30, 39, 64, 0.12),
    0 3px 10px rgba(30, 39, 64, 0.20);
  transform: scale(1.1);
  animation: none;
}

.step-progress__dot--completed {
  background: linear-gradient(135deg, var(--hop-green) 0%, var(--hop-green-dark) 100%);
  border-color: var(--hop-green);
  color: #fff;
  box-shadow: 0 2px 8px rgba(109, 179, 63, 0.25);
}

.step-progress__line {
  flex: 1;
  height: 3px;
  background: var(--hop-border);
  margin: 0 -2px;
  border-radius: 2px;
}

.step-progress__line--completed {
  background: linear-gradient(90deg, var(--hop-green) 0%, var(--hop-green-light) 100%);
  box-shadow: 0 0 6px rgba(109, 179, 63, 0.20);
}

/* ========================================================
   Hopscotch Diagram (animated interactive cards)
   ======================================================== */

.hop-diagram {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  max-width: 1200px;
  margin: 4px auto 16px;
  padding: 24px 20px;
  position: relative;
  border-radius: var(--hop-radius-xl);
  background:
    radial-gradient(ellipse 80% 60% at 30% 40%, rgba(43, 76, 126, 0.04) 0%, transparent 70%),
    radial-gradient(ellipse 60% 80% at 70% 60%, rgba(109, 179, 63, 0.04) 0%, transparent 70%);
}

.hop-diagram::before,
.hop-diagram::after {
  display: none;
}

/* Each column: either a pair (two stacked) or single (one centered) */
.hop-diagram__col {
  display: flex;
  flex-direction: column;
  gap: 14px;
  flex: 1;
  max-width: 168px;
}

.hop-diagram__col--single {
  justify-content: center;
}

.hop-diagram__col--pair {
  justify-content: center;
}

/* Individual step card */
.hop-step-card {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 18px 14px;
  min-height: 110px;
  border: none;
  border-radius: 22px;
  background: var(--card-color);
  color: #fff;
  cursor: pointer;
  font-family: inherit;
  transition: transform 0.25s cubic-bezier(0.32, 1.28, 0.48, 1), box-shadow 0.25s ease, filter 0.25s ease;
  box-shadow:
    0 2px 8px rgba(0, 0, 0, 0.08),
    inset 0 1px 0 rgba(255, 255, 255, 0.15);
  animation: hopCardIn 0.45s cubic-bezier(0.32, 1.28, 0.48, 1) both;
  overflow: hidden;
}

/* Image-based step card (e.g. Step 1 using original diagram) */
.hop-step-card--img {
  background: transparent;
  padding: 0;
  box-shadow: none;
}
.hop-step-card--img::before {
  display: none;
}
.hop-step-card__img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
  border-radius: inherit;
}

/* Glass sheen overlay for depth */
.hop-step-card::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background:
    linear-gradient(135deg, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0.05) 40%, transparent 70%),
    linear-gradient(to bottom, rgba(255,255,255,0.08) 0%, transparent 50%, rgba(0,0,0,0.06) 100%);
  pointer-events: none;
}

.hop-step-card__num {
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  opacity: 0.85;
  margin-bottom: 4px;
}

.hop-step-card__label {
  font-size: 0.82rem;
  font-weight: 600;
  line-height: 1.35;
  letter-spacing: -0.01em;
}

/* Hover: lift + glow */
.hop-step-card:hover {
  transform: translateY(-5px) scale(1.03);
  box-shadow:
    0 8px 24px rgba(0, 0, 0, 0.14),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

/* Active step: glowing ring with colored shadow */
.hop-step-card--active {
  transform: translateY(-4px) scale(1.05);
  box-shadow:
    0 0 0 3px rgba(255, 255, 255, 0.9),
    0 0 0 6px var(--card-color),
    0 0 24px color-mix(in srgb, var(--card-color) 35%, transparent),
    0 8px 28px rgba(0, 0, 0, 0.12);
  animation: none;
  overflow: hidden;
}

.hop-step-card--active::after {
  display: none;
}

.hop-step-card--active:hover {
  transform: translateY(-5px) scale(1.06);
}

/* Inactive cards dim slightly when one is active */
.hop-diagram:has(.hop-step-card--active) .hop-step-card:not(.hop-step-card--active) {
  filter: brightness(0.88) saturate(0.75);
  transform: scale(0.97);
}

.hop-diagram:has(.hop-step-card--active) .hop-step-card:not(.hop-step-card--active):hover {
  filter: brightness(1) saturate(1);
  transform: translateY(-5px) scale(1.03);
}

/* Focus-visible for keyboard nav */
.hop-step-card:focus-visible {
  outline: 3px solid var(--hop-blue);
  outline-offset: 3px;
}

/* Entrance animation */
@keyframes hopCardIn {
  from {
    opacity: 0;
    transform: translateY(16px) scale(0.92);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Step 9 (single, last) — slightly taller to match original layout */
.hop-diagram__col:last-child .hop-step-card {
  min-height: 140px;
  border-radius: 28px;
}

/* Responsive: stack to 2 rows on small screens */
@media (max-width: 900px) {
  .hop-diagram {
    flex-wrap: wrap;
    gap: 10px;
    padding: 14px 10px;
  }
  .hop-diagram__col {
    max-width: 120px;
    min-width: 100px;
  }
  .hop-step-card {
    min-height: 90px;
    padding: 14px 10px;
  }
  .hop-step-card__label {
    font-size: 0.75rem;
  }
}

@media (max-width: 600px) {
  .hop-diagram {
    gap: 8px;
  }
  .hop-diagram__col {
    max-width: 100px;
    min-width: 80px;
  }
  .hop-step-card {
    min-height: 75px;
    padding: 10px 8px;
    border-radius: 16px;
  }
  .hop-step-card__num {
    font-size: 0.6rem;
  }
  .hop-step-card__label {
    font-size: 0.68rem;
  }
}

/* ========================================================
   Split-panel tabbed layout
   ======================================================== */

/* ── Drawer Layout ── */
/* ========================================================
   Drawer Layout — Glassmorphism + Floating Command Bar
   ======================================================== */

.drawer-layout {
  position: relative;
  width: 100%;
  min-height: calc(100vh - 280px);
  padding: 12px 0 80px;          /* bottom padding for floating bar */
}

/* ── Backdrop overlay (always in DOM, toggled via CSS) ── */
.drawer-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15, 20, 35, 0.18);
  z-index: 40;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: opacity 0.18s ease-out, visibility 0.18s;
  will-change: opacity;
}

.drawer-overlay--visible {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}

/* ── Drawer panel (shared) ── */
.drawer {
  position: fixed;
  top: 0;
  bottom: 0;
  width: 440px;
  max-width: 88vw;
  z-index: 50;
  display: flex;
  flex-direction: row;
  transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  will-change: transform;
  contain: layout style paint;
}

.drawer--left {
  left: 0;
  transform: translate3d(-100%, 0, 0);
  flex-direction: row;
}

.drawer--right {
  right: 0;
  transform: translate3d(100%, 0, 0);
  flex-direction: row-reverse;
}

.drawer--open {
  transform: translate3d(0, 0, 0);
}

/* ── Accent strip (thin branded edge) ── */
.drawer__accent {
  width: 5px;
  flex-shrink: 0;
}

.drawer__accent--navy {
  background: linear-gradient(180deg, #2B4C7E 0%, #1E3A5F 40%, #3D6098 100%);
}

.drawer__accent--green {
  background: linear-gradient(180deg, #6DB33F 0%, #5A9A2F 40%, #8BC764 100%);
}

/* ── Drawer inner (glass panel) ── */
.drawer__inner {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: rgba(250, 251, 252, 0.97);
  box-shadow: 0 8px 48px rgba(0, 0, 0, 0.12), 0 2px 12px rgba(0, 0, 0, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.45);
}

/* ── Drawer header (gradient) ── */
.drawer__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  flex-shrink: 0;
  border-bottom: 1px solid rgba(0, 0, 0, 0.06);
}

.drawer__header--navy {
  background: linear-gradient(135deg, rgba(43, 76, 126, 0.08) 0%, rgba(30, 39, 64, 0.04) 100%);
}

.drawer__header--green {
  background: linear-gradient(135deg, rgba(109, 179, 63, 0.08) 0%, rgba(90, 154, 47, 0.04) 100%);
}

.drawer__header-content {
  display: flex;
  align-items: center;
  gap: 10px;
}

.drawer__header--navy .drawer__header-content svg {
  color: var(--hop-navy);
}

.drawer__header--green .drawer__header-content svg {
  color: var(--hop-green-dark);
}

.drawer__title {
  font-size: 15px;
  font-weight: 700;
  color: var(--hop-ink);
  letter-spacing: -0.01em;
}

.drawer__close {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  border: none;
  background: transparent;
  color: var(--hop-muted);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.18s;
}

.drawer__close:hover {
  background: rgba(30, 39, 64, 0.08);
  color: var(--hop-ink);
  transform: scale(1.1);
}

/* ── Drawer content ── */
.drawer__content {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  display: flex;
  flex-direction: column;
}

/* Overrides for components inside drawers */
.drawer__content .embed-card {
  border: none;
  box-shadow: none;
  padding: 0;
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  background: transparent;
}

.drawer__content .embed-frame-wrap {
  max-height: none;
  height: 100%;
  width: 100%;
  aspect-ratio: auto;
  flex: 1;
}

.drawer__content .chat-wrap {
  border: none;
  box-shadow: none;
  border-radius: 0;
  padding: 0;
  flex: 1;
  min-height: 0;
  background: transparent;
}

/* ── Floating Command Bar (macOS Dock style) ── */
.cmd-bar {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 45;
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 12px;
  border-radius: var(--hop-radius-xl);
  background: rgba(255, 255, 255, 0.72);
  backdrop-filter: blur(20px) saturate(1.8);
  -webkit-backdrop-filter: blur(20px) saturate(1.8);
  border: 1px solid rgba(255, 255, 255, 0.5);
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.10),
    0 2px 8px rgba(0, 0, 0, 0.04),
    inset 0 1px 0 rgba(255, 255, 255, 0.6);
  animation: cmdBarSlideUp 0.5s cubic-bezier(0.32, 1.28, 0.48, 1) both;
  transition: opacity 0.3s, transform 0.3s;
}

.cmd-bar--drawer-open {
  opacity: 0.5;
  transform: translateX(-50%) scale(0.95);
}

@keyframes cmdBarSlideUp {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

.cmd-bar__divider {
  width: 1px;
  height: 28px;
  background: rgba(0, 0, 0, 0.10);
  margin: 0 4px;
}

.cmd-bar__btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 20px;
  font-size: 13.5px;
  font-weight: 600;
  font-family: inherit;
  border: 1.5px solid transparent;
  background: transparent;
  color: var(--hop-ink-secondary);
  cursor: pointer;
  border-radius: var(--hop-radius-md);
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
}

.cmd-bar__btn:hover {
  background: rgba(30, 39, 64, 0.06);
  color: var(--hop-ink);
  transform: translateY(-2px);
}

.cmd-bar__btn--lesson.cmd-bar__btn--active {
  background: var(--hop-navy);
  color: #fff;
  border-color: var(--hop-navy);
  box-shadow: 0 4px 16px rgba(43, 76, 126, 0.30);
}

.cmd-bar__btn--assistant.cmd-bar__btn--active {
  background: var(--hop-green-dark);
  color: #fff;
  border-color: var(--hop-green-dark);
  box-shadow: 0 4px 16px rgba(90, 154, 47, 0.30);
}

.cmd-bar__btn--active:hover {
  transform: translateY(-2px);
}

.cmd-bar__icon {
  display: flex;
  align-items: center;
  justify-content: center;
}

.cmd-bar__label {
  letter-spacing: -0.01em;
}

/* ── Main workspace area ── */
.drawer-layout__main {
  background: rgba(255, 255, 255, 0.65);
  backdrop-filter: blur(12px) saturate(1.4);
  -webkit-backdrop-filter: blur(12px) saturate(1.4);
  border: 1px solid rgba(255, 255, 255, 0.5);
  border-radius: var(--hop-radius-lg);
  padding: 20px;
  min-height: 400px;
  overflow: hidden;
  max-height: calc(100vh - 340px);
  box-shadow:
    0 4px 24px rgba(0, 0, 0, 0.04),
    inset 0 1px 0 rgba(255, 255, 255, 0.6),
    inset 0 0 0 1px rgba(255, 255, 255, 0.15);
}

/* ── Slide page transitions ── */
.workspace-slide {
  overflow-y: auto;
  max-height: calc(100vh - 384px);
}

.workspace-slide--left {
  animation: slideFromRight 0.3s cubic-bezier(0.4, 0, 0.2, 1) both;
}

.workspace-slide--right {
  animation: slideFromLeft 0.3s cubic-bezier(0.4, 0, 0.2, 1) both;
}

@keyframes slideFromRight {
  from {
    opacity: 0;
    transform: translateX(40px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideFromLeft {
  from {
    opacity: 0;
    transform: translateX(-40px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@media (prefers-reduced-motion: reduce) {
  .workspace-slide--left,
  .workspace-slide--right {
    animation: none;
  }
}

/* ── Dark mode overrides ── */
:root[data-theme="dark"] .drawer-overlay {
  background: rgba(0, 0, 0, 0.45);
}

:root[data-theme="dark"] .drawer__inner {
  background: rgba(30, 33, 40, 0.98);
  border-color: rgba(255, 255, 255, 0.08);
  box-shadow: 0 8px 48px rgba(0, 0, 0, 0.35), 0 2px 12px rgba(0, 0, 0, 0.20);
}

:root[data-theme="dark"] .drawer__header {
  border-bottom-color: rgba(255, 255, 255, 0.06);
}

:root[data-theme="dark"] .drawer__header--navy {
  background: linear-gradient(135deg, rgba(91, 140, 200, 0.12) 0%, rgba(74, 111, 165, 0.06) 100%);
}

:root[data-theme="dark"] .drawer__header--green {
  background: linear-gradient(135deg, rgba(123, 199, 79, 0.12) 0%, rgba(109, 179, 63, 0.06) 100%);
}

:root[data-theme="dark"] .drawer__close:hover {
  background: rgba(255, 255, 255, 0.10);
}

:root[data-theme="dark"] .cmd-bar {
  background: rgba(30, 33, 40, 0.78);
  border-color: rgba(255, 255, 255, 0.10);
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.30),
    0 2px 8px rgba(0, 0, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.06);
}

:root[data-theme="dark"] .cmd-bar__divider {
  background: rgba(255, 255, 255, 0.10);
}

:root[data-theme="dark"] .cmd-bar__btn:hover {
  background: rgba(255, 255, 255, 0.08);
}

:root[data-theme="dark"] .cmd-bar__btn--lesson.cmd-bar__btn--active {
  background: var(--hop-navy);
  border-color: var(--hop-navy);
  box-shadow: 0 4px 16px rgba(91, 140, 200, 0.30);
}

:root[data-theme="dark"] .cmd-bar__btn--assistant.cmd-bar__btn--active {
  background: var(--hop-green-dark);
  border-color: var(--hop-green-dark);
  box-shadow: 0 4px 16px rgba(109, 179, 63, 0.30);
}

/* ── Responsive: full-width drawers on small screens ── */
@media (max-width: 768px) {
  .drawer {
    width: 100vw;
    max-width: 100vw;
  }

  .cmd-bar {
    bottom: 16px;
    left: 12px;
    right: 12px;
    transform: none;
    justify-content: center;
  }

  .cmd-bar--drawer-open {
    transform: scale(0.95);
  }

  @keyframes cmdBarSlideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
}

/* ========================================================
   Genially embed card
   ======================================================== */

.embed-card {
  border: 1px solid var(--hop-border);
  border-radius: var(--hop-radius-lg);
  padding: 14px;
  background: var(--hop-surface);
  box-shadow: var(--hop-shadow-sm);
  transition: box-shadow var(--hop-ease), transform var(--hop-ease);
  animation: fadeSlideIn 0.35s ease-out;
}

.embed-card:hover {
  box-shadow: var(--hop-shadow-md);
}

.embed-title {
  margin: 0 0 10px;
  font-size: 14px;
  font-weight: 600;
  color: var(--hop-navy);
}

.embed-frame-wrap {
  position: relative;
  width: 100%;
  aspect-ratio: 3 / 4;
  max-height: 650px;
  border-radius: var(--hop-radius-md);
  overflow: hidden;
  background: var(--hop-bg);
  border: 1px solid var(--hop-border-light);
}

.embed-frame-wrap iframe {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border: none;
}

.embed-placeholder {
  font-size: 0.9rem;
  color: var(--hop-muted);
}

/* ========================================================
   Step Details container
   ======================================================== */

.step-details {
  display: flex;
  flex-direction: column;
  gap: 14px;
  animation: fadeSlideIn 0.35s ease-out;
}

.step-details .hop-card {
  animation: scaleIn 0.3s ease-out both;
}

.step-details .hop-card:nth-child(1) { animation-delay: 0.05s; }
.step-details .hop-card:nth-child(2) { animation-delay: 0.12s; }
.step-details .hop-card:nth-child(3) { animation-delay: 0.19s; }

.step-details .badge {
  margin-top: 8px;
}

/* ========================================================
   Cards
   ======================================================== */

.hop-card {
  width: 100%;
  border: 1px solid var(--hop-border);
  border-radius: var(--hop-radius-lg);
  padding: 22px;
  background: var(--hop-surface);
  box-shadow: var(--hop-shadow-sm);
  transition: border-color var(--hop-ease), box-shadow var(--hop-ease), transform var(--hop-ease);
}

.hop-card:hover {
  border-color: var(--hop-blue-light);
  box-shadow: var(--hop-shadow-md);
  transform: translateY(-1px);
}

/* Directions card: blue left accent */
.step-details .hop-card:first-child {
  border-left: 3px solid var(--hop-blue);
}

.hop-title {
  font-size: 20px;
  font-weight: 700;
  margin: 0 0 8px;
  color: var(--hop-navy-dark);
}

.hop-desc {
  color: var(--hop-ink-secondary);
  font-size: 14px;
  line-height: 1.55;
  font-weight: 400;
}

.hop-desc strong {
  color: var(--hop-ink);
  font-weight: 600;
}

/* ========================================================
   Buttons
   ======================================================== */

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 10px 24px;
  border-radius: var(--hop-radius-pill);
  border: 1px solid var(--hop-border);
  background: var(--hop-surface);
  color: var(--hop-ink);
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  font-family: inherit;
  transition: all var(--hop-ease);
}

.btn:hover {
  background: var(--hop-bg);
  border-color: var(--hop-blue-light);
  color: var(--hop-blue);
  transform: translateY(-1px);
  box-shadow: var(--hop-shadow-sm);
}

.btn:active {
  transform: translateY(1px);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* Primary filled button — bright blue */
.btn--primary,
.btn.dark {
  background: var(--hop-blue);
  border-color: var(--hop-blue);
  color: var(--hop-white);
  box-shadow: 0 2px 8px rgba(30, 39, 64, 0.25);
}

.btn--primary:hover,
.btn.dark:hover {
  background: var(--hop-blue-dark);
  border-color: var(--hop-blue-dark);
  color: var(--hop-white);
  box-shadow: 0 4px 14px rgba(30, 39, 64, 0.35);
}

/* Outline button */
.btn--outline {
  background: transparent;
  border-color: var(--hop-border);
  color: var(--hop-ink-secondary);
}

.btn--outline:hover {
  border-color: var(--hop-blue);
  color: var(--hop-blue);
  background: rgba(30, 39, 64, 0.04);
}

/* Green accent button */
.btn--green {
  background: var(--hop-green);
  border-color: var(--hop-green);
  color: var(--hop-white);
}

.btn--green:hover {
  background: var(--hop-green-dark);
  border-color: var(--hop-green-dark);
}

/* ========================================================
   Form Inputs
   ======================================================== */

.input,
.textarea,
select.input {
  width: 100%;
  border: 1px solid var(--hop-border);
  border-radius: var(--hop-radius-sm);
  padding: 10px 12px;
  font-size: 14px;
  font-family: inherit;
  color: var(--hop-ink);
  background: var(--hop-surface);
  transition: border-color var(--hop-ease), box-shadow var(--hop-ease);
}

.input:focus,
.textarea:focus,
select.input:focus {
  outline: none;
  border-color: var(--hop-blue);
  box-shadow: 0 0 0 4px rgba(30, 39, 64, 0.12);
}

.input:disabled,
.textarea:disabled {
  background: var(--hop-bg);
  color: var(--hop-muted);
  cursor: not-allowed;
}

/* ========================================================
   Chat Shell
   ======================================================== */

.chat-wrap {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  border-radius: var(--hop-radius-xl);
  padding: 18px 20px;
  background: var(--hop-surface);
  border: 1px solid var(--hop-border);
  box-shadow: var(--hop-shadow-sm);
  transition: box-shadow var(--hop-ease);
}

.chat-wrap:hover {
  box-shadow: var(--hop-shadow-md);
}

/* Header */
.chat-head {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 0.75rem;
  padding-bottom: 0.6rem;
  position: relative;
}

.chat-head::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: var(--hop-border);
  animation: none;
  border-radius: 1px;
}

.chat-title {
  font-weight: 700;
  font-size: 1rem;
  color: var(--hop-navy);
  letter-spacing: -0.02em;
}

.chat-hint {
  font-size: 0.75rem;
  color: var(--hop-muted);
  font-weight: 400;
  letter-spacing: -0.005em;
}

/* Chat body / scroll area */
.chat-body {
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  padding: 0.25rem 0.1rem 0.25rem 0;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.chat-body::-webkit-scrollbar {
  width: 6px;
}
.chat-body::-webkit-scrollbar-track {
  background: transparent;
}
.chat-body::-webkit-scrollbar-thumb {
  background: rgba(148, 163, 184, 0.7);
  border-radius: 999px;
}
.chat-body:hover::-webkit-scrollbar-thumb {
  background: rgba(30, 39, 64, 0.5);
}

/* Rows + bubbles */
.chat-row {
  display: flex;
  width: 100%;
  animation: chatFadeIn 0.22s ease-out;
  font-size: 0.875rem;
}

.chat-row.user {
  justify-content: flex-end;
}

.chat-row.assistant {
  justify-content: flex-start;
}

.chat-bubble {
  max-width: min(680px, 85%);
  border-radius: var(--hop-radius-xl);
  padding: 11px 16px;
  line-height: 1.6;
  position: relative;
  border: 1px solid transparent;
  letter-spacing: -0.011em;
}

/* Assistant bubble */
.chat-bubble--assistant {
  background: var(--hop-bg);
  border-color: var(--hop-border);
  color: var(--hop-ink);
  box-shadow: none;
}

/* User bubble */
.chat-bubble--user {
  background: var(--hop-blue);
  color: #FFFFFF;
  box-shadow: 0 2px 8px rgba(30, 39, 64, 0.25);
}

/* Hover lift */
.chat-bubble--assistant:hover {
  border-color: var(--hop-blue-light);
}

.chat-bubble--user:hover {
  box-shadow: 0 4px 14px rgba(30, 39, 64, 0.35);
}

/* Markdown inside assistant bubbles */
.chat-bubble--assistant p {
  margin: 0 0 8px 0;
}
.chat-bubble--assistant ul {
  margin: 6px 0 8px 20px;
}
.chat-bubble--assistant li {
  margin: 2px 0;
}

/* Step dot on user bubbles */
.chat-step-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: 8px;
  vertical-align: middle;
  flex-shrink: 0;
}

/* ---- Step group (collapsible chat sections) ---- */
.chat-step-group {
  margin: 4px 0;
}

.chat-step-group__header {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  padding: 6px 10px;
  border: none;
  background: transparent;
  cursor: pointer;
  border-radius: var(--hop-radius);
  transition: background 0.15s;
}
.chat-step-group__header:hover {
  background: rgba(30, 39, 64, 0.06);
}

.chat-step-group__pill {
  display: inline-flex;
  align-items: center;
  padding: 2px 8px;
  border-radius: 999px;
  color: #fff;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.02em;
  white-space: nowrap;
}

.chat-step-group__label {
  font-size: 12px;
  font-weight: 600;
  color: var(--hop-navy-dark);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chat-step-group__count {
  font-size: 11px;
  color: var(--hop-ink-muted, #8896a6);
  margin-left: auto;
  white-space: nowrap;
}

.chat-step-group__arrow {
  font-size: 10px;
  color: var(--hop-ink-muted, #8896a6);
  transition: transform 0.2s;
}
.chat-step-group__arrow--open {
  transform: rotate(180deg);
}

.chat-step-group__body {
  padding: 2px 0 4px;
}

/* Border accent on assistant bubbles with step */
.chat-bubble[style*="border-left"] {
  padding-left: 20px;
}

/* Empty state */
.chat-empty {
  font-size: 0.9rem;
  color: var(--hop-muted);
  text-align: center;
  padding: 1.5rem 0.5rem;
}

/* Quick survey pills */
.quick-options {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin: 0.3rem 0 0.4rem;
}

.btn.pill {
  border-radius: var(--hop-radius-pill);
  padding: 0.4rem 1rem;
  font-size: 0.85rem;
  background: var(--hop-blue);
  color: var(--hop-white);
  border: none;
  box-shadow: 0 2px 6px rgba(30, 39, 64, 0.25);
  transition: transform var(--hop-ease), box-shadow var(--hop-ease), background var(--hop-ease);
}

.btn.pill:hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(30, 39, 64, 0.35);
  background: var(--hop-blue-dark);
}

.btn.pill:disabled {
  opacity: 0.55;
  cursor: not-allowed;
}

/* Chat input area */
.chat-input {
  margin-top: 0.25rem;
  display: flex;
  gap: 0.5rem;
  align-items: flex-end;
}

.chat-input textarea {
  flex: 1;
  resize: none;
  border-radius: 12px;
  border: 1px solid var(--hop-border);
  padding: 0.55rem 0.65rem;
  font-size: 0.9rem;
  background: var(--hop-surface);
  font-family: inherit;
  transition: border-color var(--hop-ease), box-shadow var(--hop-ease), background var(--hop-ease);
}

.chat-input textarea:focus {
  outline: none;
  border-color: var(--hop-blue);
  box-shadow: 0 0 0 2px rgba(30, 39, 64, 0.12);
  background: var(--hop-white);
}

/* --- Touch ripple on chat body click --- */
.chat-body {
  position: relative;
  overflow-x: hidden;
}

.chat-ripple {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(43, 94, 167, 0.30) 0%, rgba(30, 39, 64, 0.10) 50%, transparent 70%);
  pointer-events: none;
  transform: scale(0);
  animation: chatRipple 0.6s ease-out forwards;
}

@keyframes chatRipple {
  to {
    transform: scale(1);
    opacity: 0;
  }
}

/* References collapsible */
.collapsible {
  margin-top: 0.5rem;
}

.collapsible__btn {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.8rem;
  padding: 0.4rem 0.55rem;
  border-radius: var(--hop-radius-md);
  border: 1px dashed rgba(30, 39, 64, 0.25);
  background: var(--hop-info-bg);
  color: var(--hop-ink-secondary);
  cursor: pointer;
  font-family: inherit;
}

.collapsible__body {
  margin-top: 0.45rem;
}

.source-grid {
  display: grid;
  grid-template-columns: minmax(0, 1fr);
  gap: 0.5rem;
}

.source-card {
  border-radius: var(--hop-radius-md);
  padding: 0.55rem 0.7rem;
  background: var(--hop-bg);
  border: 1px solid var(--hop-border-light);
  font-size: 0.8rem;
}

.source-chip {
  display: inline-flex;
  padding: 0.1rem 0.4rem;
  border-radius: 999px;
  font-size: 0.7rem;
  background: var(--hop-info-bg);
  color: var(--hop-info);
}

.link-btn {
  margin-top: 0.25rem;
  background: none;
  border: none;
  padding: 0;
  font-size: 0.78rem;
  color: var(--hop-blue);
  cursor: pointer;
  text-decoration: underline;
  font-family: inherit;
}

/* Entrance animations */
@keyframes fadeSlideIn {
  from {
    opacity: 0;
    transform: translateY(12px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.98);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* Chat animation */
@keyframes chatFadeIn {
  from {
    opacity: 0;
    transform: translateY(3px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Hopscotch grid loader */
.typing-indicator {
  display: flex;
  gap: 8px;
  align-items: center;
  margin: 8px 0 8px 8px;
  background: transparent;
}

.hop-grid-loader {
  background: transparent;
  overflow: visible;
}

/* Each square lights up in sequence — pairs light together */
.hop-sq {
  opacity: 0.25;
  animation: hop-sq-light 2.7s infinite ease-in-out;
}
.sq-1 { animation-delay: 0s; }
.sq-2 { animation-delay: 0.2s; }
.sq-3 { animation-delay: 0.4s; }
.sq-4 { animation-delay: 0.6s; }
.sq-5 { animation-delay: 0.8s; }
.sq-6 { animation-delay: 1.0s; }
.sq-7 { animation-delay: 1.2s; }
.sq-8 { animation-delay: 1.4s; }
.sq-9 { animation-delay: 1.6s; }

.hop-bot-label {
  font-size: 13px;
  font-weight: 600;
  color: var(--hop-navy-dark);
  opacity: 0.7;
  animation: hop-label-pulse 2.7s infinite ease-in-out;
}

@keyframes hop-sq-light {
  0%, 100% { opacity: 0.25; transform: scale(1); }
  11%, 22%  { opacity: 1;    transform: scale(1.15); }
}

@keyframes hop-label-pulse {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 0.35; }
}

/* ========================================================
   Step-specific headings
   ======================================================== */

.step-heading {
  font-size: 22px;
  font-weight: 700;
  margin: 0 0 4px;
  color: var(--hop-navy-dark);
}

.step-subheading {
  font-size: 16px;
  font-weight: 700;
  margin: 4px 0 6px;
  color: var(--hop-navy-dark);
}

.step-text {
  font-size: 14px;
  line-height: 1.5;
  margin: 0 0 8px;
}

.step-save-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 4px 0 8px;
}

/* ========================================================
   Path-aware Steps 4-9
   ======================================================== */

/* Checkbox labels for multi_select */
.checkbox-label {
  display: flex;
  align-items: baseline;
  gap: 8px;
  padding: 4px 0;
  font-size: 14px;
  line-height: 1.5;
  cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
  flex-shrink: 0;
  margin-top: 3px;
  accent-color: var(--hop-blue);
}

.checkbox-desc {
  color: var(--hop-muted);
  font-size: 13px;
}

/* Methodology decision grid (mixed-methods Step 4) */
.methodology-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-top: 14px;
}

.methodology-col {
  background: var(--hop-bg);
  border: 1px solid var(--hop-border);
  border-radius: var(--hop-radius-md);
  padding: 18px;
}

.methodology-heading {
  font-size: 15px;
  font-weight: 700;
  margin: 0 0 10px;
  color: var(--hop-navy);
}

.methodology-list {
  font-size: 13px;
  line-height: 1.7;
  padding-left: 18px;
  margin: 0 0 14px;
}

.methodology-list li {
  margin-bottom: 4px;
}

.methodology-confirmed {
  display: flex;
  align-items: center;
  padding: 10px 16px;
  background: var(--hop-success-bg);
  border: 1px solid rgba(30, 39, 64, 0.25);
  border-radius: var(--hop-radius-sm);
  font-size: 14px;
  color: var(--hop-green-dark);
}

@media (max-width: 700px) {
  .methodology-grid {
    grid-template-columns: 1fr;
  }
}

/* ========================================================
   Responsive
   ======================================================== */

@media (max-width: 840px) {
  .hop-content {
    padding: 8px 12px 20px;
  }

  .hop-header {
    flex-direction: column;
    gap: 8px;
    padding: 0.75rem 1rem;
  }

  .hop-header__right {
    justify-content: center;
    flex-wrap: wrap;
  }

  .step-progress__dot {
    width: 28px;
    height: 28px;
    font-size: 11px;
  }
}

/* ========================================================
   Utility classes
   ======================================================== */

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}

.text-navy { color: var(--hop-navy); }
.text-green { color: var(--hop-green); }
.text-muted { color: var(--hop-muted); }
.text-error { color: var(--hop-error); }

/* ========================================================
   Login Page (ClassroomAI-inspired)
   ======================================================== */

.login-page {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: var(--hop-white);
}

/* --- Top header bar --- */
.login-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 2.5rem;
  border-bottom: 1px solid var(--hop-border);
}

.login-header__left {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.login-header-logo {
  height: 60px;
  width: 360px;
  object-fit: contain;
  object-position: left center;
}

.login-header-brand {
  font-size: 0.95rem;
  font-weight: 700;
  letter-spacing: 0.04em;
  color: var(--hop-ink);
}

/* --- Hero section --- */
.login-hero {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 4rem 2rem 6rem;
}

.login-hero__gradient {
  font-size: clamp(2.4rem, 5vw, 3.8rem);
  font-weight: 700;
  letter-spacing: -0.025em;
  margin: 0;
  background: linear-gradient(135deg, var(--hop-navy) 0%, var(--hop-green) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1.15;
}

.login-hero__rotating {
  font-size: clamp(2.4rem, 5vw, 3.8rem);
  font-weight: 700;
  letter-spacing: -0.025em;
  color: var(--hop-ink);
  margin: 0;
  line-height: 1.15;
  transition: opacity 0.35s ease, transform 0.35s ease;
}

.login-hero__rotating.fade-in {
  opacity: 1;
  transform: translateY(0);
}

.login-hero__rotating.fade-out {
  opacity: 0;
  transform: translateY(8px);
}

.login-hero__desc {
  max-width: 600px;
  font-size: 1.05rem;
  line-height: 1.7;
  color: var(--hop-ink-secondary);
  margin: 2rem 0 2.5rem;
}

.login-hero__hopscotch {
  margin: 0 0 1.8rem;
  animation: heroGridFadeIn 1s ease-out 0.2s both;
}

.hop-grid-hero {
  filter: drop-shadow(0 4px 16px rgba(30, 39, 64, 0.12));
}


@keyframes heroGridFadeIn {
  from { opacity: 0; transform: translateY(16px) scale(0.9); }
  to   { opacity: 1; transform: translateY(0) scale(1); }
}

.login-hero__actions {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 0.75rem;
  width: 100%;
  max-width: 340px;
}

/* Filled brand pill button */
.login-btn-filled {
  padding: 0.9rem 2.2rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: var(--hop-radius-pill);
  background: var(--hop-navy);
  color: var(--hop-white);
  border: none;
  cursor: pointer;
  transition: background 0.15s, box-shadow 0.15s;
  text-align: center;
}

.login-btn-filled:hover {
  background: var(--hop-navy-dark);
  box-shadow: 0 4px 14px rgba(30, 39, 64, 0.3);
}

/* Outlined pill button */
.login-btn-outline {
  padding: 0.9rem 2.2rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: var(--hop-radius-pill);
  background: transparent;
  color: var(--hop-ink);
  border: 1.5px solid var(--hop-border);
  cursor: pointer;
  transition: border-color 0.15s, color 0.15s, box-shadow 0.15s;
  text-align: center;
}

.login-btn-outline:hover {
  border-color: var(--hop-blue);
  color: var(--hop-blue);
  box-shadow: 0 2px 8px rgba(30, 39, 64, 0.1);
}

/* "or" divider */
.login-hero__divider {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin: 0.25rem 0;
}

.login-hero__divider::before,
.login-hero__divider::after {
  content: "";
  flex: 1;
  height: 1px;
  background: var(--hop-border);
}

.login-hero__divider span {
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--hop-muted);
  text-transform: lowercase;
  letter-spacing: 0.02em;
}

/* --- Split-screen auth form (ClassroomAI style) --- */
.login-split {
  display: flex;
  min-height: 100vh;
}

.login-split__left {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 2.5rem 4rem;
  background: var(--hop-white);
}

.login-split__back {
  background: none;
  border: none;
  color: var(--hop-muted);
  font-size: 0.9rem;
  cursor: pointer;
  padding: 0;
  margin-bottom: 2rem;
  font-family: inherit;
  transition: color 0.15s;
  align-self: flex-start;
}

.login-split__back:hover {
  color: var(--hop-blue);
}

.login-split__form-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  width: 100%;
  max-width: 400px;
}

.login-split__title {
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--hop-ink);
  margin: 0 0 0.5rem;
}

.login-split__subtitle {
  font-size: 0.9rem;
  color: var(--hop-muted);
  margin: 0 0 2.5rem;
}

.login-split__form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.login-field__label {
  display: block;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--hop-blue);
  margin-bottom: 0.4rem;
  letter-spacing: 0.01em;
}

.login-field__input {
  width: 100%;
  padding: 0.65rem 0;
  font-size: 0.95rem;
  border: none;
  border-bottom: 1.5px solid var(--hop-border);
  background: transparent;
  color: var(--hop-ink);
  font-family: inherit;
  transition: border-color 0.2s;
  outline: none;
  box-sizing: border-box;
}

.login-field__input::placeholder {
  color: var(--hop-placeholder);
}

.login-field__input:focus {
  border-bottom-color: var(--hop-blue);
}

.login-field__password-wrap {
  position: relative;
  display: flex;
  align-items: center;
}
.login-field__password-wrap .login-field__input {
  padding-right: 2.4rem;
}
.login-field__eye {
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.3rem;
  color: var(--hop-muted);
  display: flex;
  align-items: center;
  transition: color 0.15s;
}
.login-field__eye:hover {
  color: var(--hop-ink);
}

.login-split__submit {
  margin-top: 1rem;
  width: 100%;
  padding: 0.9rem;
  font-size: 1rem;
  font-weight: 600;
  font-family: inherit;
  border: none;
  border-radius: var(--hop-radius-pill);
  background: var(--hop-ink);
  color: var(--hop-white);
  cursor: pointer;
  transition: background 0.15s, box-shadow 0.15s;
}

.login-split__submit:hover {
  background: var(--hop-blue-dark);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
}

.login-split__submit:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.login-split__toggle {
  margin-top: 1.5rem;
  font-size: 0.85rem;
  color: var(--hop-muted);
}

/* Right branded panel */
.login-split__right {
  width: 45%;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: var(--hop-panel-dark);
  color: #FFFFFF;
}

.login-split__center {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 1.5rem;
}

.login-split__logo {
  width: 220px;
}

.login-split__hopscotch {
  animation: heroGridFadeIn 1s ease-out 0.4s both;
  filter: drop-shadow(0 4px 20px rgba(255, 255, 255, 0.08));
}

.login-split__affiliations {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  padding-bottom: 2rem;
}

.login-split__affiliation {
  height: 40px;
  width: auto;
  opacity: 0.85;
  transition: opacity 0.2s;
}

.login-split__affiliation:hover {
  opacity: 1;
}

.login-split__affiliation--ksu {
  height: 36px;
}

.login-split__brand {
  font-size: 1.1rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  opacity: 0.9;
}

@media (max-width: 768px) {
  .login-split {
    flex-direction: column;
  }
  .login-split__right {
    width: 100%;
    min-height: 180px;
    order: -1;
  }
  .login-split__left {
    padding: 2rem;
  }
}

/* --- "I'm a School Student" hero button --- */
.login-btn-school {
  padding: 0.8rem 2.2rem;
  font-size: 0.92rem;
  font-weight: 500;
  font-family: inherit;
  border-radius: var(--hop-radius-pill);
  background: rgba(30, 39, 64, 0.03);
  color: var(--hop-ink-secondary);
  border: 1.5px solid var(--hop-border);
  cursor: pointer;
  transition: border-color 0.15s, color 0.15s, background 0.15s;
  text-align: center;
  width: 100%;
}

.login-btn-school:hover {
  border-color: var(--hop-blue);
  color: var(--hop-blue);
  background: rgba(43, 94, 167, 0.04);
}

/* --- Role toggle on registration form --- */
.login-role-toggle {
  display: flex;
  gap: 0;
  border: 1.5px solid var(--hop-border);
  border-radius: var(--hop-radius-pill);
  overflow: hidden;
  width: fit-content;
}

.login-role-btn {
  padding: 0.5rem 1.5rem;
  font-size: 0.85rem;
  font-weight: 600;
  font-family: inherit;
  border: none;
  background: transparent;
  color: var(--hop-muted);
  cursor: pointer;
  transition: all 0.15s;
}

.login-role-btn--active {
  background: var(--hop-blue);
  color: white;
}

.login-role-btn:not(.login-role-btn--active):hover {
  background: rgba(30, 39, 64, 0.04);
  color: var(--hop-ink);
}

/* User identity (avatar + name) */
.hop-user {
  display: flex;
  align-items: center;
  gap: 10px;
}

.hop-user__avatar {
  width: 34px;
  height: 34px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--hop-navy), var(--hop-green));
  color: #fff;
  font-size: 0.85rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  letter-spacing: 0.02em;
  box-shadow: 0 2px 8px rgba(30, 39, 64, 0.25);
}

.hop-user__name {
  font-size: 0.9rem;
  color: var(--hop-ink);
  font-weight: 600;
  letter-spacing: -0.01em;
}

/* ========================================================
   Teacher Dashboard  (td-* prefix)
   ======================================================== */

.td {
  min-height: 100vh;
  background: var(--hop-bg);
  display: flex;
  flex-direction: column;
}

/* ── Header ── */
.td-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 2rem;
  background: var(--hop-surface);
  border-bottom: 1px solid var(--hop-border);
}

.td-header__left {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.td-header__logo {
  height: 44px;
  width: auto;
}

.td-header__right {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.td-header__user {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.td-header__avatar {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: var(--hop-blue);
  color: #fff;
  font-size: 0.85rem;
  font-weight: 700;
  flex-shrink: 0;
}

.td-header__name {
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--hop-ink);
}

.td-header__signout {
  padding: 0.4rem 0.9rem;
  font-size: 0.8rem;
  font-weight: 600;
  font-family: inherit;
  border: 1.5px solid var(--hop-border);
  border-radius: var(--hop-radius-pill);
  background: transparent;
  color: var(--hop-ink-secondary);
  cursor: pointer;
  transition: all var(--hop-ease);
}

.td-header__signout:hover {
  border-color: var(--hop-red, #D94040);
  color: var(--hop-red, #D94040);
  background: rgba(217, 64, 64, 0.06);
}

/* ── Navigation ── */
.td-nav {
  background: var(--hop-surface);
  border-bottom: 1px solid var(--hop-border);
}

.td-nav__inner {
  display: flex;
  gap: 0;
  padding: 0 2rem;
  max-width: 1200px;
  margin: 0 auto;
}

.td-nav__tab {
  padding: 0.75rem 1.5rem;
  font-size: 0.88rem;
  font-weight: 600;
  font-family: inherit;
  border: none;
  background: transparent;
  color: var(--hop-muted);
  cursor: pointer;
  border-bottom: 2.5px solid transparent;
  transition: color 0.15s, border-color 0.15s;
  white-space: nowrap;
}

.td-nav__tab:hover {
  color: var(--hop-ink);
}

.td-nav__tab--active {
  color: var(--hop-blue);
  border-bottom-color: var(--hop-blue);
}

/* ── Main content area ── */
.td-content {
  flex: 1;
  padding: 2rem;
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  box-sizing: border-box;
}

/* ── Card (create class form) ── */
.td-card {
  background: var(--hop-surface);
  border: 1px solid var(--hop-border);
  border-radius: var(--hop-radius-lg);
  padding: 1.75rem;
  box-shadow: var(--hop-shadow-sm);
}

.td-card__header {
  margin-bottom: 1.25rem;
}

.td-card__title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--hop-ink);
  margin: 0 0 0.3rem;
}

.td-card__desc {
  font-size: 0.85rem;
  color: var(--hop-muted);
  margin: 0;
  line-height: 1.5;
}

/* ── Form layout ── */
.td-form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.td-form__grid {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.td-form__group {
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
}

.td-form__group--grow {
  flex: 1;
  min-width: 180px;
}

.td-form__group--narrow {
  flex: 0 0 100px;
  min-width: 100px;
}

.td-form__label {
  font-size: 0.78rem;
  font-weight: 600;
  color: var(--hop-ink-secondary);
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

.td-form__input {
  padding: 0.55rem 0.75rem;
  border: 1.5px solid var(--hop-border);
  border-radius: var(--hop-radius-md);
  font-family: inherit;
  font-size: 0.9rem;
  color: var(--hop-ink);
  background: var(--hop-bg);
  transition: border-color 0.15s;
  width: 100%;
  box-sizing: border-box;
}

.td-form__input:focus {
  outline: none;
  border-color: var(--hop-blue);
  box-shadow: 0 0 0 3px rgba(43, 94, 167, 0.1);
}

/* ── Buttons ── */
.td-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  font-family: inherit;
  font-weight: 600;
  border-radius: var(--hop-radius-pill);
  cursor: pointer;
  transition: all var(--hop-ease);
  white-space: nowrap;
}

.td-btn--primary {
  padding: 0.6rem 1.6rem;
  font-size: 0.88rem;
  background: var(--hop-blue);
  color: #fff;
  border: none;
}

.td-btn--primary:hover {
  background: var(--hop-navy-dark);
  box-shadow: var(--hop-shadow-md);
}

.td-btn--primary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.td-btn--outline {
  background: transparent;
  border: 1.5px solid var(--hop-border);
  color: var(--hop-ink-secondary);
}

.td-btn--outline:hover {
  border-color: var(--hop-blue);
  color: var(--hop-blue);
  background: rgba(43, 94, 167, 0.04);
}

.td-btn--sm {
  padding: 0.35rem 0.9rem;
  font-size: 0.8rem;
}

/* ── Alerts ── */
.td-alert {
  padding: 0.65rem 1rem;
  border-radius: var(--hop-radius-md);
  font-size: 0.85rem;
  font-weight: 500;
}

.td-alert--error {
  background: rgba(217, 64, 64, 0.08);
  color: var(--hop-red, #D94040);
  border: 1px solid rgba(217, 64, 64, 0.2);
}

/* ── Create result (success) ── */
.td-result {
  margin-top: 1.5rem;
  padding: 1.25rem;
  background: var(--hop-success-bg);
  border: 1px solid rgba(109, 179, 63, 0.25);
  border-radius: var(--hop-radius-md);
}

.td-result__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.75rem;
}

.td-result__badge {
  display: inline-block;
  padding: 2px 10px;
  font-size: 0.72rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  background: var(--hop-green, #6db33f);
  color: #fff;
  border-radius: 999px;
}

.td-result__dismiss {
  width: 26px;
  height: 26px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  background: transparent;
  color: var(--hop-green-dark);
  cursor: pointer;
  font-size: 1.1rem;
  border-radius: 50%;
  transition: background 0.15s;
}

.td-result__dismiss:hover {
  background: rgba(0, 0, 0, 0.06);
}

/* ── Key-value row (reusable) ── */
.td-kv-row {
  display: flex;
  gap: 2rem;
  flex-wrap: wrap;
  margin-bottom: 0.75rem;
}

.td-kv {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.td-kv__label {
  font-size: 0.7rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: var(--hop-muted);
}

.td-kv__value {
  font-size: 0.92rem;
  font-weight: 600;
  font-family: "Geist Mono", monospace;
  color: var(--hop-ink);
}

/* ── Roster chips ── */
.td-roster {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.td-roster__chip {
  display: inline-block;
  padding: 4px 10px;
  font-size: 0.78rem;
  font-family: "Geist Mono", monospace;
  background: var(--hop-neutral-bg);
  border: 1px solid var(--hop-border);
  border-radius: var(--hop-radius-sm);
  color: var(--hop-ink);
}

/* ── Section (class list heading) ── */
.td-section {
  margin-top: 2rem;
}

.td-section__title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 1.05rem;
  font-weight: 700;
  color: var(--hop-ink);
  margin: 0 0 1rem;
}

.td-section__count {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 22px;
  height: 22px;
  padding: 0 6px;
  font-size: 0.72rem;
  font-weight: 700;
  background: var(--hop-blue);
  color: #fff;
  border-radius: 999px;
}

/* ── Empty + muted helper text ── */
.td-empty {
  text-align: center;
  color: var(--hop-muted);
  padding: 3rem 0;
  font-size: 0.9rem;
}

.td-empty p {
  margin: 0;
}

.td-muted {
  color: var(--hop-muted);
  font-size: 0.9rem;
}

/* ── Class list ── */
.td-class-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* ── Individual class card ── */
.td-class {
  background: var(--hop-surface);
  border: 1px solid var(--hop-border);
  border-radius: var(--hop-radius-md);
  overflow: hidden;
  transition: box-shadow var(--hop-ease);
}

.td-class:hover {
  box-shadow: var(--hop-shadow-sm);
}

.td-class--open {
  box-shadow: var(--hop-shadow-md);
}

.td-class__header {
  display: flex;
  align-items: center;
  width: 100%;
  padding: 0.9rem 1.25rem;
  background: transparent;
  border: none;
  cursor: pointer;
  font-family: inherit;
  text-align: left;
  color: var(--hop-ink);
  gap: 1rem;
}

.td-class__title {
  font-size: 0.95rem;
  font-weight: 700;
  color: var(--hop-ink);
  flex-shrink: 0;
}

.td-class__meta {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex: 1;
  min-width: 0;
}

.td-class__tag {
  display: inline-block;
  padding: 2px 8px;
  font-size: 0.72rem;
  font-weight: 700;
  font-family: "Geist Mono", monospace;
  background: rgba(43, 94, 167, 0.08);
  color: var(--hop-blue);
  border-radius: var(--hop-radius-sm);
  letter-spacing: 0.02em;
  white-space: nowrap;
}

.td-class__stat {
  font-size: 0.8rem;
  color: var(--hop-muted);
  white-space: nowrap;
}

.td-class__date {
  font-size: 0.78rem;
  color: var(--hop-muted);
  opacity: 0.7;
  white-space: nowrap;
  margin-left: auto;
}

.td-class__chevron {
  font-size: 0.7rem;
  color: var(--hop-muted);
  transition: transform 0.2s;
  flex-shrink: 0;
}

.td-class__chevron--open {
  transform: rotate(180deg);
}

.td-class__body {
  padding: 1rem 1.25rem 1.25rem;
  border-top: 1px solid var(--hop-border-light);
}

.td-class__actions {
  margin-top: 0.75rem;
  padding-top: 0.75rem;
  border-top: 1px solid var(--hop-border-light);
}

/* ── Progress table (student sessions) ── */
.td-table-wrap {
  overflow-x: auto;
  border: 1px solid var(--hop-border);
  border-radius: var(--hop-radius-md);
  background: var(--hop-surface);
}

.td-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.88rem;
}

.td-table th {
  text-align: left;
  padding: 0.7rem 1rem;
  background: var(--hop-bg);
  border-bottom: 1px solid var(--hop-border);
  font-weight: 600;
  color: var(--hop-ink-secondary);
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  white-space: nowrap;
}

.td-table td {
  padding: 0.7rem 1rem;
  border-bottom: 1px solid var(--hop-border-light);
  color: var(--hop-ink);
}

.td-table tr:last-child td {
  border-bottom: none;
}

.td-table tr:hover td {
  background: var(--hop-bg);
}

.td-table__name {
  font-weight: 600;
}

.td-table__mono {
  font-family: "Geist Mono", monospace;
  font-size: 0.82rem;
}

.td-table__cap {
  text-transform: capitalize;
}

.td-table__muted {
  color: var(--hop-muted);
  font-size: 0.82rem;
}

/* ── Step badge (in progress table) ── */
.td-step-badge {
  display: inline-block;
  padding: 2px 8px;
  font-size: 0.75rem;
  font-weight: 600;
  background: rgba(43, 94, 167, 0.08);
  color: var(--hop-blue);
  border-radius: var(--hop-radius-sm);
  white-space: nowrap;
}

/* ── Progress dots ── */
.td-dots {
  display: flex;
  align-items: center;
  gap: 3px;
}

.td-dots__dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--hop-border);
  flex-shrink: 0;
  transition: background 0.15s;
}

.td-dots__dot--done {
  background: var(--hop-green);
}

.td-dots__count {
  font-size: 0.7rem;
  color: var(--hop-muted);
  margin-left: 4px;
  font-weight: 600;
  white-space: nowrap;
}

/* ── Teacher Dashboard responsive ── */
@media (max-width: 768px) {
  .td-header {
    flex-direction: column;
    gap: 8px;
    padding: 0.75rem 1rem;
  }
  .td-content {
    padding: 1rem;
  }
  .td-nav__inner {
    padding: 0 1rem;
  }
  .td-form__grid {
    flex-direction: column;
  }
  .td-form__group--narrow {
    flex: 1;
  }
  .td-kv-row {
    gap: 1rem;
  }
  .td-class__header {
    flex-wrap: wrap;
  }
  .td-class__meta {
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .td-class__date {
    margin-left: 0;
  }
}

/* ========================================================
   Ambient Animations (keyframes)
   ======================================================== */


/* Active step card breathing glow */
@keyframes cardBreathGlow {
  0%, 100% {
    box-shadow:
      0 0 0 3px #fff,
      0 0 0 6px var(--card-color),
      0 8px 24px rgba(0, 0, 0, 0.2);
  }
  50% {
    box-shadow:
      0 0 0 3px #fff,
      0 0 0 8px var(--card-color),
      0 8px 28px rgba(0, 0, 0, 0.25),
      0 0 20px rgba(30, 39, 64, 0.15);
  }
}

/* Active card wobble tilt */
@keyframes activeWobble {
  0%, 100% { transform: translateY(-2px) scale(1.05) rotateZ(0deg); }
  20%      { transform: translateY(-2px) scale(1.05) rotateZ(-3deg); }
  40%      { transform: translateY(-2px) scale(1.05) rotateZ(3deg); }
  60%      { transform: translateY(-2px) scale(1.05) rotateZ(-2deg); }
  80%      { transform: translateY(-2px) scale(1.05) rotateZ(1deg); }
}

/* Active card shimmer sweep */
@keyframes activeShimmer {
  0%        { transform: translateX(-100%) rotate(25deg); opacity: 0; }
  15%       { opacity: 1; }
  50%       { transform: translateX(200%) rotate(25deg); opacity: 0; }
  100%      { transform: translateX(200%) rotate(25deg); opacity: 0; }
}

/* Completed card shimmer sweep */
@keyframes shimmerSweep {
  0%   { transform: translateX(-100%) rotate(25deg); }
  100% { transform: translateX(200%) rotate(25deg); }
}

/* Completed card: green checkmark badge in top-right */
.hop-step-card--completed::after {
  content: "\2713";
  position: absolute;
  top: 8px;
  right: 8px;
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: var(--hop-green);
  color: #fff;
  font-size: 12px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(109, 179, 63, 0.35);
  animation: checkBadgeIn 0.35s cubic-bezier(0.32, 1.28, 0.48, 1) both;
}

@keyframes checkBadgeIn {
  from { transform: scale(0); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}

/* Active progress dot pulse ring */
@keyframes dotPulseRing {
  0%, 100% {
    box-shadow: 0 0 0 4px rgba(30, 39, 64, 0.18);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(30, 39, 64, 0.08);
  }
}

/* Completed progress line shimmer */
@keyframes lineShimmer {
  0%   { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

/* Floating decorative particles */
@keyframes floatUpDown {
  0%, 100% { transform: translateY(0px); }
  50%      { transform: translateY(-12px); }
}

@keyframes floatLeftRight {
  0%, 100% { transform: translateX(0px); }
  50%      { transform: translateX(10px); }
}

/* Chat header gradient underline */
@keyframes borderGradientSlide {
  0%   { background-position: 0% 50%; }
  100% { background-position: 200% 50%; }
}

/* Logo gentle float */
@keyframes gentleFloat {
  0%, 100% { transform: translateY(0); }
  50%      { transform: translateY(-2px); }
}

/* ========================================================
   Dark Mode — element-specific overrides
   ======================================================== */

:root[data-theme="dark"] .hop-step-card--active {
  box-shadow:
    0 0 0 3px rgba(255, 255, 255, 0.15),
    0 0 0 6px var(--card-color),
    0 0 28px color-mix(in srgb, var(--card-color) 30%, transparent),
    0 8px 28px rgba(0, 0, 0, 0.35);
}

:root[data-theme="dark"] .hop-step-card {
  box-shadow:
    0 4px 12px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

:root[data-theme="dark"] .hop-step-card:hover {
  box-shadow:
    0 8px 24px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.12);
}

:root[data-theme="dark"] .hop-diagram {
  background:
    radial-gradient(ellipse 80% 60% at 30% 40%, rgba(91, 140, 200, 0.06) 0%, transparent 70%),
    radial-gradient(ellipse 60% 80% at 70% 60%, rgba(123, 199, 79, 0.06) 0%, transparent 70%);
}

:root[data-theme="dark"] .hop-diagram::before,
:root[data-theme="dark"] .hop-diagram::after {
  display: none;
}

:root[data-theme="dark"] .panel-tabs--pill .panel-tabs__btn {
  border-color: rgba(255, 255, 255, 0.15);
}

:root[data-theme="dark"] .panel-tabs--pill .panel-tabs__btn:hover {
  background: rgba(255, 255, 255, 0.06);
  color: var(--hop-ink);
}

:root[data-theme="dark"] .panel-tabs--pill .panel-tabs__btn--active {
  background: var(--hop-blue);
  border-color: var(--hop-blue);
  color: #fff;
}

:root[data-theme="dark"] .panel-tabs--pill .panel-tabs__btn--active::after {
  display: none;
}

:root[data-theme="dark"] .panel-tabs--pill .panel-tabs__btn--active:hover {
  background: var(--hop-blue-dark);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  color: #fff;
}

:root[data-theme="dark"] .chat-step-group__header:hover {
  background: rgba(255, 255, 255, 0.06);
}

:root[data-theme="dark"] .chat-body:hover::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.3);
}

:root[data-theme="dark"] .chat-body::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.15);
}

:root[data-theme="dark"] .chat-ripple {
  background: radial-gradient(circle, rgba(107, 143, 192, 0.25) 0%, rgba(255, 255, 255, 0.08) 50%, transparent 70%);
}

:root[data-theme="dark"] .hop-header {
  background: rgba(30, 33, 40, 0.78);
  border-bottom-color: rgba(255, 255, 255, 0.06);
  box-shadow:
    0 1px 3px rgba(0, 0, 0, 0.3),
    inset 0 -1px 0 rgba(255, 255, 255, 0.04);
}

:root[data-theme="dark"] .hop-download__menu {
  background: rgba(30, 33, 40, 0.88);
  border-color: rgba(255, 255, 255, 0.08);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.45);
}

:root[data-theme="dark"] .drawer-layout__main {
  background: rgba(30, 33, 40, 0.55);
  border-color: rgba(255, 255, 255, 0.06);
  box-shadow:
    0 4px 24px rgba(0, 0, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.04),
    inset 0 0 0 1px rgba(255, 255, 255, 0.03);
}

:root[data-theme="dark"] .step-progress__dot {
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
}

:root[data-theme="dark"] .step-progress__dot--active {
  box-shadow:
    0 0 0 4px rgba(74, 111, 165, 0.18),
    0 3px 10px rgba(74, 111, 165, 0.25);
}

:root[data-theme="dark"] .step-progress__dot--completed {
  box-shadow: 0 2px 8px rgba(123, 199, 79, 0.30);
}

:root[data-theme="dark"] .step-progress__line--completed {
  box-shadow: 0 0 6px rgba(123, 199, 79, 0.25);
}

:root[data-theme="dark"] .login-header-logo {
  width: 305px;
}

:root[data-theme="dark"] .btn--primary:hover,
:root[data-theme="dark"] .btn.dark:hover {
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.4);
}

:root[data-theme="dark"] .chat-bubble--user {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

:root[data-theme="dark"] .chat-bubble--user:hover {
  box-shadow: 0 4px 14px rgba(0, 0, 0, 0.4);
}

/* Theme toggle button */
.theme-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 34px;
  height: 34px;
  border-radius: 50%;
  border: 1.5px solid var(--hop-border);
  background: transparent;
  color: var(--hop-ink-secondary);
  cursor: pointer;
  font-size: 16px;
  transition: border-color 0.15s, color 0.15s, background 0.15s;
  padding: 0;
  line-height: 1;
}

.theme-toggle:hover {
  border-color: var(--hop-blue);
  color: var(--hop-blue);
  background: rgba(30, 39, 64, 0.04);
}

:root[data-theme="dark"] .theme-toggle:hover {
  background: rgba(255, 255, 255, 0.06);
}

/* ========================================================
   Reduced Motion: disable ambient/continuous animations
   ======================================================== */

@media (prefers-reduced-motion: reduce) {
  .hop-step-card--active {
    animation: none;
  }

  .hop-step-card--active::after {
    animation: none;
    display: none;
  }

  .hop-step-card--completed::after {
    animation: none;
  }

  .step-progress__dot--active {
    animation: none;
  }

  .step-progress__line--completed {
    animation: none;
    background: var(--hop-green);
  }

  .hop-diagram::before,
  .hop-diagram::after {
    animation: none;
    display: none;
  }

  .chat-head::after {
    animation: none;
  }

  .hop-logo {
    animation: none;
  }

  .hop-step-card {
    animation-duration: 0.01s;
  }

  .step-details .hop-card {
    animation-duration: 0.01s;
  }

  .embed-card {
    animation-duration: 0.01s;
  }

  .hop-grid-loader {
    width: 56px;
    height: 23px;
  }
}


/* ========================================================
   Session History Panel
   ======================================================== */

/* Overlay backdrop */
.session-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.3);
  z-index: 100;
  animation: sessionFadeIn 0.2s ease-out;
}

@keyframes sessionFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Slide-in sidebar */
.session-panel {
  position: fixed;
  top: 0;
  left: 0;
  width: 360px;
  max-width: 90vw;
  height: 100vh;
  background: var(--hop-surface);
  border-right: 1px solid var(--hop-border);
  box-shadow: 4px 0 24px rgba(0, 0, 0, 0.12);
  z-index: 101;
  display: flex;
  flex-direction: column;
  animation: slideInLeft 0.25s ease-out;
  overflow: hidden;
}

@keyframes slideInLeft {
  from { transform: translateX(-100%); }
  to { transform: translateX(0); }
}

.session-panel__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.25rem 1.5rem 0.75rem;
  border-bottom: 1px solid var(--hop-border);
}

.session-panel__title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--hop-ink);
  margin: 0;
}

.session-panel__close {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: 1px solid var(--hop-border);
  background: transparent;
  color: var(--hop-muted);
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--hop-ease);
}

.session-panel__close:hover {
  border-color: var(--hop-blue);
  color: var(--hop-blue);
}

.session-panel__new {
  margin: 1rem 1.5rem;
  width: calc(100% - 3rem);
  text-align: center;
  padding: 0.65rem 1.2rem;
  font-size: 0.9rem;
  border-radius: var(--hop-radius-pill);
}

.session-panel__list {
  flex: 1;
  overflow-y: auto;
  padding: 0 1.5rem 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.session-panel__empty {
  text-align: center;
  color: var(--hop-muted);
  font-size: 0.85rem;
  padding: 2rem 0;
}

/* Individual session card */
.session-card {
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding: 14px 16px;
  border: 1px solid var(--hop-border);
  border-radius: var(--hop-radius-md);
  background: var(--hop-surface);
  cursor: pointer;
  text-align: left;
  font-family: inherit;
  transition: all var(--hop-ease);
  width: 100%;
  position: relative;
}

.session-card:hover {
  border-color: var(--hop-blue-light);
  box-shadow: var(--hop-shadow-md);
  transform: translateY(-1px);
}

.session-card--active {
  border-left: 4px solid var(--hop-green);
  background: var(--hop-success-bg);
  border-color: var(--hop-green);
}

.session-card__topic {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--hop-ink);
  line-height: 1.3;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  padding-right: 60px;
}

.session-card__meta {
  display: flex;
  justify-content: space-between;
  font-size: 0.78rem;
  color: var(--hop-muted);
}

.session-card__path {
  text-transform: capitalize;
  font-weight: 500;
}

.session-card__path--none {
  font-style: italic;
  opacity: 0.7;
}

/* Mini progress dots */
.session-card__progress {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 2px;
}

.session-card__dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--hop-border);
  flex-shrink: 0;
}

.session-card__dot--done {
  background: var(--hop-green);
}

.session-card__step-count {
  font-size: 0.7rem;
  color: var(--hop-muted);
  margin-left: 4px;
  font-weight: 600;
}

.session-card__current-badge {
  position: absolute;
  top: 12px;
  right: 12px;
  font-size: 0.65rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--hop-green-dark);
  background: var(--hop-success-bg);
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid var(--hop-green);
}

/* Header history button */
.session-history-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 1.5px solid var(--hop-border);
  background: transparent;
  color: var(--hop-ink-secondary);
  cursor: pointer;
  transition: all var(--hop-ease);
  padding: 0;
  margin-left: 12px;
}

.session-history-btn:hover {
  border-color: var(--hop-blue);
  color: var(--hop-blue);
  background: rgba(30, 39, 64, 0.04);
}

/* Dark mode overrides */
:root[data-theme="dark"] .session-overlay {
  background: rgba(0, 0, 0, 0.5);
}

:root[data-theme="dark"] .session-panel {
  box-shadow: 4px 0 24px rgba(0, 0, 0, 0.4);
}

:root[data-theme="dark"] .session-history-btn:hover {
  background: rgba(255, 255, 255, 0.06);
}


/* ========================================================
   Conceptual Framework Editor (Slide 3 — angular polygons)
   Exact polygon coordinates extracted from PPTX freeform shapes.
   Two-layer approach: background polygons + text overlays.
   ======================================================== */

.cf-overlay {
  position: fixed;
  inset: 0;
  z-index: 200;
  background: #e8e8e8;
  display: flex;
  flex-direction: column;
  overflow: auto;
}

/* Toolbar */
.cf-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.6rem 1.5rem;
  background: #fff;
  border-bottom: 1px solid #ddd;
  flex-shrink: 0;
}

.cf-toolbar__left,
.cf-toolbar__right {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.cf-toolbar__title {
  font-size: 0.95rem;
  font-weight: 700;
  color: #1e2740;
}

.cf-toolbar__hint {
  font-size: 0.78rem;
  color: #999;
  font-style: italic;
}

.cf-toolbar__btn {
  padding: 0.4rem 1rem;
  font-size: 0.85rem;
  font-weight: 600;
  font-family: inherit;
  border: 1.5px solid #ccc;
  border-radius: 999px;
  background: #fff;
  color: #555;
  cursor: pointer;
  transition: all 0.15s;
}

.cf-toolbar__btn:hover {
  border-color: #2B5EA7;
  color: #2B5EA7;
}

.cf-toolbar__btn--primary {
  background: #2B5EA7;
  border-color: #2B5EA7;
  color: #fff;
}

.cf-toolbar__btn--primary:hover {
  background: #1e4a8a;
}

.cf-toolbar__center {
  display: flex;
  align-items: center;
}

.cf-toolbar__template-toggle {
  display: flex;
  border: 1.5px solid #ccc;
  border-radius: 999px;
  overflow: hidden;
}

.cf-toolbar__template-btn {
  padding: 0.35rem 1rem;
  font-size: 0.82rem;
  font-weight: 600;
  font-family: inherit;
  border: none;
  background: #fff;
  color: #777;
  cursor: pointer;
  transition: all 0.15s;
}

.cf-toolbar__template-btn + .cf-toolbar__template-btn {
  border-left: 1.5px solid #ccc;
}

.cf-toolbar__template-btn:hover {
  color: #2B5EA7;
  background: #f0f4fa;
}

.cf-toolbar__template-btn--active {
  background: #2B5EA7;
  color: #fff;
}

.cf-toolbar__template-btn--active:hover {
  background: #1e4a8a;
  color: #fff;
}

/* Page wrapper — centers the diagram */
.cf-page {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

/* The diagram — fixed aspect ratio matching PPTX (10" x 6.25" = 1.6:1) */
.cf-diagram {
  position: relative;
  width: min(1200px, 94vw);
  aspect-ratio: 10 / 6.25;
  background: #fff;
  border-radius: 4px;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
  overflow: hidden;
  font-size: 14px;
}

/* ── Editable text ── */
.cf-editable {
  display: inline-block;
  outline: none;
  border-radius: 3px;
  padding: 1px 3px;
  transition: background 0.15s;
  cursor: text;
  min-width: 40px;
  word-break: break-word;
}

.cf-editable:hover {
  background: rgba(255, 255, 255, 0.15);
}

.cf-editable:focus {
  background: rgba(255, 255, 255, 0.25);
  box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
}

.cf-text--light { color: #fff; }
.cf-text--dark { color: #1e2740; }
.cf-text--sm { font-size: 0.78em; line-height: 1.4; }
.cf-text--name { font-weight: 700; }
.cf-text--footer { color: #073763; }

/* ── Labels ── */
.cf-label {
  display: block;
  font-weight: 700;
  font-size: 0.85em;
  margin-bottom: 2px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.cf-label--light { color: #fff; }
.cf-label--dark { color: #1e2740; text-shadow: none; }

/* ═══════════════════════════════════════════════════
   Layer 1: Background polygon shapes
   Exact vertices from PPTX freeform shape coordinates.
   Each covers the full diagram and is clipped to its polygon.
   ═══════════════════════════════════════════════════ */
.cf-bg {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

/* Per-shape white border outlines.
   Each SVG has the same z-index as its shape (via inline style).
   Higher shapes cover lower outlines → borders only at visible boundaries.
   CSS clip-path hides strokes at the container edges. */
.cf-border {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  clip-path: inset(0.3% 0.3% 9.3% 0.3%);
}
.cf-border polygon {
  fill: none;
  stroke: #ffffff;
  stroke-width: 2px;
  vector-effect: non-scaling-stroke;
  stroke-linejoin: round;
}

/*
   Z-index matches PPTX draw order (later shapes on top):
   Green(1) → Teal(2) → Yellow(3) → Brown(4) → Orange(5) → Blue(6)
   → Red(7) → Gray(8) → LightBlue(9)
   Polygons use original PPTX coordinates; footer covers bottom 9%.
*/

/* Green — Problem Statement, right-middle (drawn first = bottom) */
.cf-bg--green {
  background: #6AA84F;
  clip-path: polygon(60.9% 47.2%, 100% 24.3%, 100% 100%, 84.1% 100%, 56.9% 64.9%);
  z-index: 1;
}

/* Teal — Research Questions, bottom-right */
.cf-bg--teal {
  background: #0097A7;
  clip-path: polygon(55.8% 64.8%, 83.9% 100%, 100% 100%, 100% 68.2%, 57.9% 55.6%);
  z-index: 2;
}

/* Yellow — Personal Interests, left-middle.
   Top edge follows blue's bottom edge (0,24.5)→(40,47.3) exactly to eliminate
   the white gap. Blue (z:6) covers the overlap above. */
.cf-bg--yellow {
  background: #F1C232;
  clip-path: polygon(0% 24.5%, 40% 47.3%, 44% 24.3%, 44% 100%, 27.7% 100%, 0% 68.2%);
  z-index: 3;
}

/* Brown — Identity & Positionality, bottom-left */
.cf-bg--brown {
  background: #7F6000;
  clip-path: polygon(44.1% 64.8%, 15.9% 100%, 0% 100%, 0% 68.2%, 42.4% 54.9%);
  z-index: 4;
}

/* Orange — Theoretical Frameworks, top-right */
.cf-bg--orange {
  background: #FFAB40;
  clip-path: polygon(50.6% 36.4%, 50.6% 0%, 100% 0%, 100% 24.6%, 61% 47.3%);
  z-index: 5;
}

/* Blue — Topical Research, top-left (on top of yellow & orange) */
.cf-bg--blue {
  background: #1C4587;
  clip-path: polygon(50.6% 36.4%, 50.6% 0%, 0% 0%, 0% 24.5%, 40% 47.3%);
  z-index: 6;
}

/* Red — Research Design, bottom-center */
.cf-bg--red {
  background: #CC0000;
  clip-path: polygon(44.2% 64.9%, 56.8% 64.8%, 76.9% 91.2%, 22.9% 91.4%);
  z-index: 7;
}

/* Gray — Research Topic, center pentagon */
.cf-bg--gray {
  background: #666666;
  clip-path: polygon(50.65% 36.5%, 61% 47.4%, 57% 64.9%, 44% 64.9%, 40.3% 47.4%);
  z-index: 8;
}

/* Light Blue — Gap/s Found, top-center triangle (topmost) */
.cf-bg--lightblue {
  background: #CFE2F3;
  clip-path: polygon(50.6% 36.6%, 34.6% 0%, 65.7% 0%);
  z-index: 9;
}

/* ═══════════════════════════════════════════════════
   Layer 2: Text content overlays
   Positioned to match PPTX text box coordinates.
   ═══════════════════════════════════════════════════ */
.cf-txt {
  position: absolute;
  z-index: 11;
  pointer-events: auto;
}

/* Topical Research label */
.cf-txt--topical-label {
  left: 0.4%;
  top: 0.5%;
  width: 16%;
}

/* Individual topic items (staircase) */
.cf-txt--topic {
  width: 23%;
  font-size: 0.78em;
  color: #fff;
}

/* Theoretical Frameworks label */
.cf-txt--fw-label {
  right: 0.5%;
  top: 0.5%;
  width: 19%;
  text-align: right;
}

/* Individual framework items (reverse staircase) */
.cf-txt--framework {
  width: 23%;
  font-size: 0.78em;
  color: #fff;
  text-align: right;
}

/* Gap/s Found */
.cf-txt--gaps {
  left: 39%;
  top: 0.5%;
  width: 23%;
  text-align: center;
}

/* Research Topic (center pentagon) */
.cf-txt--topic-center {
  left: 42%;
  top: 42%;
  width: 17%;
  text-align: center;
}

/* Personal Interests & Goals */
.cf-txt--interests {
  left: 0.4%;
  top: 41%;
  width: 29%;
}

/* Identity & Positionality */
.cf-txt--identity {
  left: 1.4%;
  top: 68%;
  width: 31%;
}

/* Problem Statement */
.cf-txt--problem {
  left: 71%;
  top: 44%;
  width: 28%;
}

/* Research Design */
.cf-txt--design {
  left: 43%;
  top: 65%;
  width: 15%;
  text-align: center;
}

/* Research Questions */
.cf-txt--questions {
  left: 70.5%;
  top: 69%;
  width: 28%;
  text-align: right;
}

/* ── Footer bar (covers bottom 9% matching PPTX footer area) ── */
.cf-footer {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 9%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  background: #fff;
  z-index: 20;
  font-size: 0.68em;
  color: #073763;
}

.cf-footer__left,
.cf-footer__right {
  flex: 1;
}

.cf-footer__right {
  text-align: right;
}

.cf-footer__center {
  font-weight: 700;
  font-size: 1.15em;
  text-align: center;
  flex: 2;
}

.cf-footer__logo {
  height: 80%;
  max-height: 36px;
  width: auto;
  object-fit: contain;
  margin-left: 12px;
  flex-shrink: 0;
}
.cf-footer__grid {
  height: 70%;
  max-height: 28px;
  width: auto;
  margin-left: 10px;
  flex-shrink: 0;
}

/* Color tile bar at the very bottom of the diagram */
.cf-tile-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 8px;
  z-index: 21;
  display: flex;
}
.cf-tile-bar span {
  flex: 1;
}

/* ── CF Loading overlay ── */
.cf-loading-overlay {
  position: fixed;
  inset: 0;
  z-index: 200;
  background: rgba(30, 39, 64, 0.6);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
}

.cf-loading-card {
  background: #fff;
  border-radius: 16px;
  padding: 2.5rem 3rem;
  text-align: center;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
  max-width: 400px;
}

.cf-loading-spinner {
  width: 48px;
  height: 48px;
  border: 4px solid #e8e8e8;
  border-top-color: #2B5EA7;
  border-radius: 50%;
  margin: 0 auto 1.25rem;
  animation: cf-spin 0.8s linear infinite;
}

@keyframes cf-spin {
  to { transform: rotate(360deg); }
}

.cf-loading-text {
  font-size: 1.1rem;
  font-weight: 700;
  color: #1e2740;
  margin: 0 0 0.5rem;
}

.cf-loading-sub {
  font-size: 0.85rem;
  color: #888;
  margin: 0;
  line-height: 1.4;
}

/* ═══════════════════════════════════════════════════
   Template 2: Boxed / Card Layout (.cfb-* prefix)
   Rectangular card sections in a flowchart arrangement
   matching the "Hopscotch Create your Research Design" PPTX.
   ═══════════════════════════════════════════════════ */

.cfb-diagram {
  position: relative;
  width: min(1200px, 96vw);
  aspect-ratio: 10 / 6.5;
  background: #fff;
  border-radius: 4px;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
  overflow: hidden;
  font-size: 13px;
  color: #1e2740;
  display: flex;
  flex-direction: column;
}

/* ── Text helpers ── */
.cfb-text--meta { color: #8B0000; font-weight: 600; }
.cfb-text--name { font-weight: 700; color: #073763; }
.cfb-text--body { font-size: 0.92em; line-height: 1.4; }

/* ── Header: email/date left, CF name center-right ── */
.cfb-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  padding: 10px 20px 6px;
}

.cfb-header__meta {
  font-size: 0.85em;
  font-weight: 700;
  color: #8B0000;
  line-height: 1.5;
}

.cfb-header__title {
  font-size: 1.2em;
  font-weight: 700;
  color: #073763;
  text-align: right;
}

/* ── Main content: sidebar + connector + main flow ── */
.cfb-content {
  flex: 1;
  display: flex;
  padding: 0 14px 0 14px;
  gap: 0;
  min-height: 0;
}

/* ── Left sidebar cards ── */
.cfb-sidebar {
  width: 210px;
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  padding-top: 6px;
  margin-right: 8px;
}

/* Card with colored header strip */
.cfb-card {
  border: 2px solid #999;
  border-radius: 4px;
  overflow: hidden;
  flex: 1;
  display: flex;
  flex-direction: column;
}

.cfb-card__header {
  font-weight: 700;
  font-size: 0.88em;
  padding: 6px 10px;
  text-align: center;
  color: #fff;
}

.cfb-card__header--red { background: #C0504D; }
.cfb-card__header--yellow { background: #C9960C; color: #fff; }

.cfb-card__body {
  padding: 12px 10px;
  flex: 1;
}

.cfb-card--personal .cfb-card__body { background: #F4CCCC; }
.cfb-card--identity .cfb-card__body { background: #F1C232; }

/* Midpoint connector area between sidebar cards */
.cfb-connector-mid {
  display: flex;
  align-items: center;
  flex-shrink: 0;
}

/* Vertical connector line */
.cfb-connector-v {
  width: 2px;
  height: 28px;
  background: #555;
  margin-left: 50%;
  flex-shrink: 0;
}

/* Arrow connector: sidebar → lit review */
.cfb-arrow-right--connector {
  flex-shrink: 0;
  padding: 0 2px;
  margin-left: auto;
}

/* ── Main flow column (right of sidebar) ── */
.cfb-main {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

/* Literature Review teal banner */
.cfb-lit-banner {
  background: #0097A7;
  color: #fff;
  text-align: center;
  font-weight: 700;
  font-size: 1em;
  padding: 5px 0;
  letter-spacing: 0.5px;
}

/* 3-column literature review area */
.cfb-lit-area {
  display: flex;
  border: 2px solid #0097A7;
  border-top: none;
  flex: 1;
  min-height: 0;
}

.cfb-col {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 8px;
  gap: 6px;
}

.cfb-col__heading {
  font-weight: 700;
  font-size: 0.92em;
  text-align: center;
  padding-bottom: 4px;
  margin-bottom: 2px;
}

.cfb-col__item {
  padding: 4px 6px;
  font-size: 0.9em;
}

/* Topical Research: light blue bg */
.cfb-col--topics {
  background: #CFE2F3;
}

.cfb-col--topics .cfb-col__heading {
  color: #1C4587;
}

/* Center column: Research Topic */
.cfb-col--center {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #D6E4F0;
  border-left: 2px solid #0097A7;
  border-right: 2px solid #0097A7;
}

/* Research Topic — large rounded rect */
.cfb-topic-box {
  width: 85%;
  aspect-ratio: 1;
  max-width: 180px;
  border-radius: 16px;
  background: #2B5EA7;
  border: 3px solid #1C4587;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 14px;
}

.cfb-topic-box__label {
  font-weight: 700;
  font-size: 0.95em;
  margin-bottom: 6px;
}

/* Theoretical Frameworks: mauve/pink bg */
.cfb-col--frameworks {
  background: #D5B8D5;
}

.cfb-col--frameworks .cfb-col__heading {
  color: #4A235A;
}

/* ── Flow boxes below literature review ── */
.cfb-flow-box {
  padding: 10px 16px;
  text-align: center;
  border: 1.5px solid #aaa;
}

.cfb-flow-box__label {
  font-weight: 700;
  font-size: 0.9em;
  display: block;
  margin-bottom: 2px;
}

.cfb-flow-box--gaps {
  background: #D6E4F0;
  border-color: #999;
}

.cfb-flow-box--problem {
  background: #FDEBD0;
  border-color: #E0A84C;
}

.cfb-flow-box--questions {
  background: #93C47D;
  border-color: #6AA84F;
  color: #fff;
  flex: 1.6;
}

.cfb-flow-box--questions .cfb-flow-box__label { color: #fff; }

.cfb-flow-box--design {
  background: #D5B8D5;
  border-color: #9C7BBD;
  flex: 1;
}

/* Arrows */
.cfb-arrow-down {
  text-align: center;
  font-size: 1.5em;
  color: #555;
  line-height: 1;
  padding: 2px 0;
}

.cfb-arrow-right {
  font-size: 1.5em;
  color: #555;
  padding: 0 6px;
  display: flex;
  align-items: center;
}

/* Bottom row */
.cfb-bottom-row {
  display: flex;
  gap: 8px;
  align-items: stretch;
}

/* ── Footer ── */
.cfb-footer {
  padding: 8px 16px;
  display: flex;
  align-items: center;
}

.cfb-footer__logo {
  height: 44px;
  width: auto;
  object-fit: contain;
}

.cfb-footer__grid {
  height: 32px;
  width: auto;
  margin-left: 10px;
}

/* ═══════════════════════════════════════════════════
   Template 3: Extended 3-Column + Pinwheel (.cfe-*)
   ═══════════════════════════════════════════════════ */

.cfe-diagram {
  position: relative;
  width: min(1200px, 96vw);
  aspect-ratio: 10 / 6.5;
  background: #fff;
  border-radius: 4px;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
  overflow: hidden;
  font-size: 12px;
  color: #1e2740;
  display: flex;
  flex-direction: column;
}

/* ── Text helpers ── */
.cfe-text--meta { color: #8B0000; font-weight: 600; }
.cfe-text--topic { color: #073763; }
.cfe-text--body { font-size: 0.92em; line-height: 1.35; }

/* ── Header ── */
.cfe-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  padding: 8px 16px 4px;
  gap: 12px;
}

.cfe-header__meta {
  font-size: 0.85em;
  font-weight: 700;
  color: #8B0000;
  line-height: 1.5;
  flex-shrink: 0;
}

.cfe-header__topic {
  font-size: 1.15em;
  color: #073763;
  text-align: center;
  flex: 1;
}

.cfe-header__logo {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}

.cfe-header__logo-img {
  height: 36px;
  width: auto;
  object-fit: contain;
}

.cfe-header__grid {
  height: 28px;
  width: auto;
}

/* ── 3-column body ── */
.cfe-body {
  flex: 1;
  display: flex;
  padding: 0 10px 8px;
  gap: 8px;
  min-height: 0;
}

/* ── Columns ── */
.cfe-col {
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-height: 0;
}

.cfe-col--left {
  flex: 0 0 22%;
}

.cfe-col--center {
  flex: 1;
}

.cfe-col--right {
  flex: 0 0 22%;
}

/* ── Cards ── */
.cfe-card {
  border: 1.5px solid #999;
  border-radius: 3px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.cfe-card__header {
  font-weight: 700;
  font-size: 0.9em;
  padding: 5px 10px;
  text-align: center;
}

.cfe-card__body {
  padding: 8px 10px;
  flex: 1;
}

/* Unified card colors: header + body same background, header text colored */
.cfe-card--topics .cfe-card__header,
.cfe-card--topics .cfe-card__body { background: #CFE2F3; }
.cfe-card--topics .cfe-card__header { color: #1C4587; }

.cfe-card--frameworks .cfe-card__header,
.cfe-card--frameworks .cfe-card__body { background: #D5B8D5; }
.cfe-card--frameworks .cfe-card__header { color: #4A235A; }

.cfe-card--personal .cfe-card__header,
.cfe-card--personal .cfe-card__body { background: #F4CCCC; }
.cfe-card--personal .cfe-card__header { color: #C0504D; }

.cfe-card--identity .cfe-card__header,
.cfe-card--identity .cfe-card__body { background: #FFF2CC; }
.cfe-card--identity .cfe-card__header { color: #7F6000; }

.cfe-card--litreview .cfe-card__header,
.cfe-card--litreview .cfe-card__body { background: #E0F7FA; }
.cfe-card--litreview .cfe-card__header { color: #0097A7; }

.cfe-card--problem .cfe-card__header,
.cfe-card--problem .cfe-card__body { background: #FDEBD0; }
.cfe-card--problem .cfe-card__header { color: #BF6900; }

.cfe-card--questions .cfe-card__header,
.cfe-card--questions .cfe-card__body { background: #93C47D; }
.cfe-card--questions .cfe-card__header { color: #1B5E20; }

.cfe-card--design .cfe-card__header,
.cfe-card--design .cfe-card__body { background: #D5B8D5; }
.cfe-card--design .cfe-card__header { color: #4A235A; }

.cfe-card__item {
  padding: 3px 0;
}

.cfe-card__label {
  font-weight: 700;
  font-size: 0.9em;
  display: block;
  margin-bottom: 2px;
}

/* Make topics/frameworks cards grow equally */
.cfe-col--left .cfe-card:first-child,
.cfe-col--right .cfe-card:first-child {
  flex: 1.4;
}

.cfe-col--left .cfe-card:nth-child(2),
.cfe-col--left .cfe-card:nth-child(3),
.cfe-col--right .cfe-card:nth-child(2),
.cfe-col--right .cfe-card:nth-child(3) {
  flex: 1;
}

/* ── Pinwheel infographic ── */
.cfe-infographic {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  min-height: 0;
}

.cfe-infographic__title {
  font-weight: 700;
  font-size: 0.95em;
  color: #C0504D;
  text-align: center;
  padding: 4px 0 2px;
}

.cfe-infographic__citation {
  font-size: 0.75em;
  font-style: italic;
  color: #666;
  text-align: center;
  padding: 2px 0;
}

/* ── Wheel (SVG-based pie-chart circle with 5 sections) ── */
.cfe-wheel {
  position: relative;
  width: 95%;
  max-width: 560px;
  aspect-ratio: 1 / 1;
  margin: 4px auto;
  font-size: 14px;
}

/* SVG fills the wheel container */
.cfe-wheel__svg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

/* Section text labels (positioned at pie-slice centroids) */
.cfe-slabel {
  position: absolute;
  width: 26%;
  text-align: center;
  color: #fff;
  pointer-events: none;
  line-height: 1.15;
  z-index: 7;
}

.cfe-slabel strong {
  display: block;
  font-size: 0.82em;
  font-weight: 700;
  margin-bottom: 2px;
}

.cfe-slabel span {
  font-size: 0.48em;
  line-height: 1.1;
  display: block;
}

/* Position labels at each pie-slice centroid (no rotation needed) */
.cfe-slabel--0 { left: 50%;  top: 18%; transform: translate(-50%, -50%); }
.cfe-slabel--1 { left: 80%;  top: 40%; transform: translate(-50%, -50%); }
.cfe-slabel--2 { left: 69%;  top: 74%; transform: translate(-50%, -50%); }
.cfe-slabel--3 { left: 31%;  top: 74%; transform: translate(-50%, -50%); }
.cfe-slabel--4 { left: 20%;  top: 40%; transform: translate(-50%, -50%); }

/* Center circle with CF definition */
.cfe-wheel__center {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 40%;
  height: 40%;
  border-radius: 50%;
  background: #6AA84F;
  border: 2.5px solid #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2.5%;
  text-align: center;
  color: #fff;
  z-index: 10;
}

.cfe-wheel__center span {
  font-size: 0.48em;
  line-height: 1.2;
}

/* ── Research Design row with flanking arrows ── */
.cfe-design-row {
  display: flex;
  align-items: stretch;
  gap: 4px;
}

.cfe-design-row .cfe-card {
  flex: 1;
}

.cfe-design-arrow {
  display: flex;
  align-items: center;
  font-size: 1.8em;
  color: #6AA84F;
  padding: 0 2px;
  flex-shrink: 0;
}

/* ── Print styles ── */
@media print {
  /* Force background colors and images to print */
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color-adjust: exact !important;
  }

  /* Landscape, fill entire page */
  @page {
    size: landscape;
    margin: 0;
  }

  /* Hide everything except the diagram */
  body > *:not(#root),
  .no-print {
    display: none !important;
  }

  /* Reset the overlay to fill the page */
  .cf-overlay {
    position: fixed !important;
    inset: 0 !important;
    background: #fff !important;
    z-index: 999999 !important;
    overflow: hidden !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }

  .cf-page {
    padding: 0 !important;
    margin: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }

  .cf-diagram {
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    max-height: none !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    page-break-inside: avoid !important;
    position: relative !important;
    overflow: hidden !important;
  }

  /* Ensure background shapes render with colors */
  .cf-bg {
    position: absolute !important;
    inset: 0 !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* Ensure SVG borders render */
  .cf-border {
    position: absolute !important;
    inset: 0 !important;
  }

  /* Footer */
  .cf-footer {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* Tile bar */
  .cf-tile-bar {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }
  .cf-tile-bar span {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* No hover/focus effects */
  .cf-editable:hover,
  .cf-editable:focus {
    background: transparent !important;
    box-shadow: none !important;
  }

  /* ── Boxed template print ── */
  .cfb-diagram {
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    box-shadow: none !important;
    border-radius: 0 !important;
  }

  .cfb-card__header,
  .cfb-card__body,
  .cfb-lit-banner,
  .cfb-lit-area,
  .cfb-col--topics,
  .cfb-col--center,
  .cfb-col--frameworks,
  .cfb-topic-box,
  .cfb-flow-box,
  .cfb-footer {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* ── Extended template print ── */
  .cfe-diagram {
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    box-shadow: none !important;
    border-radius: 0 !important;
  }

  .cfe-card__header,
  .cfe-card__body,
  .cfe-design-arrow,
  .cfe-wheel__svg,
  .cfe-wheel__center,
  .cfe-wheel,
  [class*="cfe-card--"] .cfe-card__header,
  [class*="cfe-card--"] .cfe-card__body {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }
}
